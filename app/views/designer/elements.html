#{extends 'main.html' /}
#{set title:'Elements' /}
#{set assessmentCode:assessment.code /}

#{set 'moreStyles'}
#{/set}

<section class="ui page centered padded stackable grid">
  <div class="twelve wide column" id="sticker">
  <h2 class="ui header">
    <i class="sort alphabet ascending icon"></i>
    <div class="content">
      &{'assessment.designer.Elements'}
      <div class="sub header">طراحی و تغییر معیارها و پرسش‌ها</div>
    </div>
  </h2>

  <div class="ui segment">
	  
	  <div class="ui basic center aligned segment">
	    <div class="ui large #{element.color 'metric' /} floating metric dropdown labeled icon button">
        <i class="#{element.icon 'metric' /} icon"></i>
	      معیار
        <div class="menu">
          <a href="@{Elements.create(assessmentCode,'metric')}" class="item">
            <i class="#{element.color 'metric' /} #{element.icon 'metric' /} circular inverted icon"></i> معیار اصلی
          </a>
          <a href="@{Elements.create(assessmentCode,'sub_metric')}" class="item">
            <i class="#{element.color 'sub_metric' /} #{element.icon 'sub_metric' /} circular inverted icon"></i> معیار فرعی
          </a>
        </div>
      </div>
      <a href="@{Elements.create(assessmentCode,'question')}" class="ui large #{element.color 'question' /} labeled icon button">
        <i class="#{element.icon 'question' /} icon"></i> پرسش
      </a>
	  </div>
	  <div class="ui divider"></div>
	  
	  <div id="current-elements">
		  #{list assessment.elements}
	    <div class="ui large #{element.color controllers.Elements.findElementByCode(_)?.elementType() /} label" style="margin-bottom:5px;" data-element="${_}">
        #{ifnot preventUpdate}
	      <i class="drag-handle bars icon"></i>
	      #{/ifnot}
	      <a href="@{Elements.preview(_)}">
	        <i class="#{element.icon controllers.Elements.findElementByCode(_)?.elementType() /} icon"></i>
	        ${controllers.Elements.findElementByCode(_)?.title}
	      </a>
	      #{ifnot preventUpdate}
	      <div class="detail">
	        <a href="@{Elements.delete(_)}" title="Remove this element."><i class="red link delete icon"></i></a>
	      </div>
	      #{/ifnot}
	    </div>
		  #{/list}
		  #{else}
		  #{/else}
	  </div>
	</div>
  </div> <!-- /.segment -->


	<div class="four wide column">
	<div class="ui sticky">
	  <div class="ui small side-help list">
	    <div class="item">
	      <i class="top aligned right circle help icon"></i>
	      <div class="content">
	        <div class="header">معیار</div>
	        <div class="description">Use this block to present information to the user.</div>
	      </div>
	    </div>
      <div class="item">
        <i class="top aligned right circle help icon"></i>
        <div class="content">
          <div class="header">معیار اصلی</div>
          <div class="description">You can ask for long or short text answers to be typed in.</div>
        </div>
      </div>
	    <div class="item">
	      <i class="top aligned right circle help icon"></i>
	      <div class="content">
	        <div class="header">معیار فرعی</div>
	        <div class="description">Add as many choices as you want. You can also allow selection of multiple choices.</div>
	      </div>
	    </div>
      <div class="item">
        <i class="top aligned right circle help icon"></i>
        <div class="content">
          <div class="header">پرسش</div>
          <div class="description">You can ask for long or short text answers to be typed in.</div>
        </div>
      </div>
      <div class="item">
        <i class="top aligned right circle warning icon"></i>
        <div class="content">
          <div class="header"></div>
          <div class="description">Any changes to the current experiment flow results in loss of previously stored data.</div>
        </div>
      </div>
	  </div>
	</div> <!-- /.ui.sticky -->
	</div>
</section>

#{set 'moreScripts'}
#{ifnot preventUpdate}
  <script src="@{'/public/js/sortable.min.js'}"></script>
  <script>
  var elements = document.getElementById('current-elements');
  Sortable.create(elements, {
    animation: 150,
    handle: ".bars.icon",
    onUpdate: function (evt){
      var elementsArray = [];
      $('#current-elements').children().each(function(){
        elementsArray.push($(this).data('element'));
      });
      $.post("@{Elements.sortElements}", {
        'assessment.id': '${assessment.id}',
        'elements[]': elementsArray
      }).done(function(data) {
        $.growl.notice({
          title:'',
          message:data,
          location:'br'
        });
      }); 
    }
  }); // That's all.
  $('.metric.dropdown').dropdown({
    action: 'hide',
    transition: 'drop'
  });
  </script>
#{/ifnot}
#{/set}
